name: SonarQube
on:
    # Trigger analysis when pushing to your main branches, and when creating a pull request.
    push:
        branches:
            - main
            - master
            - develop
            - 'releases/**'
    pull_request:
        types: [opened, synchronize, reopened]

jobs:
    sonarqube:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3

            - name: SonarQube PR
              if: github.event_name == 'pull_request'
              working-directory: jhdf
              run: >
                ./gradlew sonarqube
                  -Dsonar.login=${{ secrets.SONAR_TOKEN }}
                  -Dsonar.pullrequest.branch=${{ github.ref }}
                  -Dsonar.pullrequest.key=${{ github.ref.name }}
                  -Dsonar.pullrequest.base=${{ github.base.ref }}
                  -Dsonar.pullrequest.github.repository=${{ github.server_url }}/${{ github.repository }}

